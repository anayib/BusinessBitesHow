<div class="paper-back-full">
  <div class="login-form-full" style="padding-top:20px;">
    <div class="fix-box">
      <div class="text-center title-logo animated fadeInDown animation-delay-5" style="padding-top:20px;">
        business<span>bites</span>
      </div>
      <div class="transparent-div no-padding animated fadeInUp animation-delay-8">
        <ul class="nav nav-tabs nav-tabs-transparent">
          <li style="width: 50%;" id="account_created">
            <a href="" onclick="return false">1 Crear Cuenta</a>
          </li>
          <li class="active" style="width: 50%;">
            <a href="" data-toggle="tab">2 Pagar Subscripción</a>
          </li>
        </ul>
        <!-- Tab panes -->
        <div class="tab-content">
          <div class="tab-pane active" id="home">
            <% unless @subscription.errors.blank? %>
              <%= @subscription.errors.full_messages.to_sentence %>
            <% end %>

            <h3 class="text-center">Elige uno de los siguientes planes:</h3> 
            <div class="row" id="plan_buttons">
              <div class="col-md-12 text-center">
                <button class="btn-ar btn-success" data-name="Plan VIP Anual" data-id="<%= Plan.find_by_stripe_id("anual").id %>" data-price="204.99" id="anual">
                  Subscripción<br><span style="text-decoration: line-through;">$239.88</span> $204.99 dólares/año
                </button>
                <button class="btn-ar btn-success" data-name="Plan VIP Mensual" data-id="<%= Plan.find_by_stripe_id("mensual").id %>" data-price="19.99" id="mensual ">
                  Subscripción<br>$19.99 dólares/mes
                </button>
              </div>
            </div> 
            <h2>Suscribirse a: <span id="plan_name"></span></h2>

            <%= form_for @subscription, html: { id: 'payment-form' } do |f| %>
              <input type="hidden" id="plan_selected" name="plan_id" value="0"/>
              <span class="payment-errors"></span>
              
              <div class="field form-group input-group login-input">
                <span class="input-group-addon"><i class="fa fa-user"></i></span> 
                <%= text_field_tag :card_number, nil, name: nil, class: "form-control", placeholder: "Número Tarjete de Crédito", :data => {:stripe => 'number' } %>
              </div>
              
              <div class="field form-group input-group login-input">    
                <span class="input-group-addon"><i class="fa fa-user"></i></span>
                <%= text_field_tag :card_code, nil, name: nil, placeholder: "CVC", :data => {:stripe => 'cvc' } %>
                <img src="http://i592.photobucket.com/albums/tt5/Mardini03/creditcardlogos-2%201.png" height="34px" width="145px" alt="" class="supported_cards">
              </div>
              
              <div class="field form-group input-group login-input">
                <label>
                <span>Expiración de tarjeta (MM/YY)</span>
                <input type="text" size="2" data-stripe="exp-month"/>
                </label>
                <span> / </span>
                <input type="text" size="4" data-stripe="exp-year"/><br><br>
                Total a pagar: <span id="plan_price"></span>
              </div>

              <button type="submit" id="pay_button" class="btn btn-ar btn-primary pull-right btn-lg">Selecciona un plan</button>
            <% end %>            
          </div>            
        </div>
      </div>
      <div class="row animated fadeInDown animation-delay-13" id="powered_by_stripe">
        <div class="col-md-12 text-center">
          Pago seguro 
          <img src="http://i592.photobucket.com/albums/tt5/Mardini03/solid.png" alt="">
        </div>
      </div>      
    </div>
  </div>
</div>
<script>
  $(document).on("ready page:load", function() {
    var hidden = $('input#plan_selected');
    $("button#pay_button").attr("disabled", "disabled");
    $("div#plan_buttons").on('click', 'button', function() {
      $("button#pay_button").removeAttr("disabled");
      $("button#pay_button").html("Pagar Ahora");  
      var button = $(this);
      $('span#plan_name').html(button.data("name"));
      if(button.data("price")==204.99){
        $('span#plan_price').html(button.data("price")+" dólares/año");
      }else {
        $('span#plan_price').html(button.data("price")+" dólares/mes");
      }
      console.log(button.data("name"));
      console.log(button.data("price"));
      console.log(button.data("id"));
      hidden.val(button.data("id"));  
      console.log(hidden.value);      
    }); 
  });
</script>
